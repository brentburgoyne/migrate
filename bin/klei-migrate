#!/usr/bin/env node

/**
 * This is a SUPER-WORK-IN-PROGRESS...
 * Almost not ready at all, but soon.
 */

var args = process.argv.slice(2),
    migrate = require('../.');

switch (args.shift()) {
    case 'new':
    case 'create':
        migrate.create(args.join(' '), function (err, name) {
            if (err) {
                console.error(err);
            } else {
                console.log('Migration: "' + name + '" created!');
            }
        });
        break;
    case 'run':
        var direction = args.indexOf('--up') >= 0 || args.indexOf('--down') == -1 ? 'up' : 'down',
            one = args.indexOf('--one') >= 0,
            dry = args.indexOf('--status') >= 0,
            name = args.pop();

        if (name && name.indexOf('-') === 0) {
            name = null;
        }

        migrate.direction(direction);

        if (one) {
            migrate.limit(1);
        }

        if (dry) {
            migrate.dry(name, function (migratable) {
                console.log('What to migrate ' + migrate.direction() + ':');
                console.log(migratable);
            });
        } else {
            migrate.run(name, function (err, migrated) {
                if (migrated.length) {
                    console.log('Migrated:', migrated);
                }
                if (err) {
                    console.error('Migration failed!');
                    console.error(err);
                } else {
                    console.log('All done!');
                }
            });
        }
        break;
    default:
        console.log('Nothing to do...');
        break;
}
